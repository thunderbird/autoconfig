name: Validate client config

on: [pull_request]

jobs:
  validate_config:
    runs-on: ubuntu-latest

    env:
      PYTHONDEVMODE: 1

    steps:
      - uses: actions/checkout@v6

      - name: BOM check
        run: |
          ! grep -rlI $'\xEF\xBB\xBF' ispdb

      - name: Validate file extensions
        run: |
          set -o pipefail
          shopt -s extglob nullglob
          files=( ispdb/!(*.xml) )
          if (( ${#files[*]} )); then
              for file in "${files[@]}"; do
                  printf '::error file=%s::File name "%s" does not end in .xml â€“ Please rename!\n' "$file" "$file"
              done
              exit 1
          fi

      - name: Validate XML content
        run: |
          pip install lxml
          python tools/validate.py ispdb/*
